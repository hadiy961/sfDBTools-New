# Default configuration for sfDBTools

backup:
  compression:
    type: zstd # Tipe kompresi: gzip, zstd, xz, zlib, pgzip, none
    level: 5 # Compression level dari 1 (tercepat, kompresi paling rendah) hingga 9 (paling lambat, kompresi paling tinggi)
    enabled: true
  mysqldump_args: -fQq --max-statement-time=0 --max-allowed-packet=1G --hex-blob --order-by-primary --single-transaction --routines=true --triggers=true --opt --net-buffer-length=16M
  exclude:
    user: false
    system_databases: true
    data: false
    empty: false
  include:
    include_dmart: false
    # uncomment and set databases to include specific DBs
    # databases: 
    #   - dbsf_biznet_dadfs
    #   - dbsf_biznet_jtrust
    #   - dbsf_biznet_mariadb
    # or use a file to list databases
    # file : config/db_list.txt
  cleanup:
    # Cleanup retention untuk file backup lama.
    # Jika ingin dijalankan otomatis via systemd timer:
    # - set enabled=true dan schedule (cron 5 kolom)
    # - jalankan: sfDBTools cleanup schedule start
    enabled: false
    schedule: "" # contoh: "0 2 * * *" (tiap hari 02:00)
    days: 0 # jumlah hari retensi (0 = tidak melakukan delete)
  encryption:
    enabled: true
  output:
    # base_directory: /media/ArchiveDB
    # Nama file backup saat ini menggunakan pattern FIXED internal:
    # {database}_{year}{month}{day}_{hour}{minute}{second}_{hostname}.sql[.<compression>][.enc]
    base_directory: /media/ArchiveDB
    file_permissions: "0600" # File permissions untuk backup files (default: 0600 untuk keamanan)
    metadata_permissions: "0600" # File permissions untuk metadata (default: 0600 untuk keamanan)
    structure:
      create_subdirs: true
      pattern: "{year}{month}{day}/"
    save_backup_info: true
  verification:
    disk_space_check: false
  replication:
    capture_gtid: true
    replication_user: repl_user
    replication_password: repl_password

  # Scheduler backup berbasis systemd timer.
  # - Format schedule menggunakan cron (5 kolom)
  # - Banyak job diperbolehkan (local/NFS/NAS, harian/mingguan/bulanan, dll)
  # - Eksekusi job dipaksa SERIAL (antri) via global lock (tidak paralel)
  scheduler:
    jobs:
      # - name: local_daily
      #   enabled: true
      #   schedule: "0 2 * * *" # tiap hari 02:00
      #   mode: separated
      #   include_file: /etc/sfDBTools/config/db_list.txt
      #   profile: /etc/sfDBTools/config/db_profile/source.cnf.enc
      #   ticket: "SCHEDULED"
      #   output:
      #     base_directory: /backup/local
      #   cleanup:
      #     enabled: true
      #     retention_days: 7
      #
      # - name: nfs_every_3_days
      #   enabled: true
      #   schedule: "0 1 */3 * *" # tiap 3 hari 01:00
      #   mode: separated
      #   include_file: /etc/sfDBTools/config/db_list.txt
      #   profile: /etc/sfDBTools/config/db_profile/source.cnf.enc
      #   ticket: "SCHEDULED"
      #   output:
      #     base_directory: /mnt/nfs/backup
      #   cleanup:
      #     enabled: true
      #     retention_days: 14

config_dir:
  database_profile: /etc/sfDBTools/config/db_profile

general:
  locale:
    date_format: "2006-01-02"
    time_format: "15:04:05"
    timezone: Asia/Jakarta

log:
  format: text
  level: info #TRACE, DEBUG, INFO, WARN, ERROR, FATAL, PANIC
  output:
    console:
      enabled: true
    file:
      dir: /var/log/sfDBTools
      enabled: true
      filename_pattern: sfDBTools_{date}.log
      rotation:
        compress_old: true
        daily: true
        max_size: 100MB
        retention_days: 7
  timezone: Asia/Jakarta

profile:
  connection:
    timeout: 30s 

mariadb:
  # Opsional: override path key material MariaDB untuk derive master key ENV terenkripsi.
  # Jika dikosongkan, sfDBTools akan fallback ke default: /var/lib/mysql/key_maria_nbc.txt
  key_maria_nbc_file: ""

script:
  # Jika diisi, output file .sftools dari `sfDBTools script encrypt` akan disimpan ke folder ini.
  # Jika kosong, default: satu folder dengan file entrypoint.
  bundle_output_dir: "/etc/sfDBTools/scripts"
